{"version":3,"file":"connect2ic-vue.cjs.js","sources":["../src/context.ts","../src/composables/useDialog.ts","../src/composables/useProviders.ts","../src/composables/useConnect.ts","../src/composables/useWallet.ts","../src/components/ConnectButton.vue","../src/components/ConnectDialog.vue","../src/Connect2ICProvider.vue","../src/composables/useBalance.ts","../src/composables/useCanister.ts","../src/composables/useTransfer.ts"],"sourcesContent":["import type { InjectionKey, Ref } from \"vue\"\nimport type { createClient } from \"@connect2ic/core\"\n\nexport type ContextState = {\n  client: ReturnType<typeof createClient>\n  dialog: {\n    open: () => void\n    close: () => void\n    isOpen: Ref<boolean>\n  }\n}\n\nconst contextKey: InjectionKey<ContextState> = Symbol()\n\nexport { contextKey }\n","import { contextKey } from \"../context\"\nimport {inject} from \"vue\"\n\nexport function useDialog() {\n  const context = inject(contextKey)\n  return {\n    ...context.dialog\n  }\n}","import { contextKey } from \"../context\"\nimport { useSelector } from \"@xstate/vue\"\nimport { inject } from \"vue\"\n\nexport function useProviders() {\n  const {client} = inject(contextKey)\n  return useSelector(client._service, (state) => state.context.providers)\n}\n","import { inject, computed, watch, onMounted, onUnmounted } from \"vue\"\nimport { useSelector } from \"@xstate/vue\"\nimport { contextKey } from \"../context\"\nimport { useActor } from \"@xstate/vue\"\n\ntype Props = {\n  onConnect?: () => void\n  onDisconnect?: () => void\n}\n\nconst useConnect = (props: Props = {}) => {\n  const {\n    onConnect = () => {\n    },\n    onDisconnect = () => {\n    },\n  } = props\n  const { client } = inject(contextKey)\n  const principal = useSelector(client._service, state => state.context.principal)\n  const activeProvider = useSelector(client._service, state => state.context.activeProvider)\n  // @ts-ignore\n  const status = useSelector(client._service, state => state.value.idle)\n  const { state } = useActor(client._service)\n  const isConnected = computed(() => state.value.matches({ idle: \"connected\" }) ?? false)\n  const isInitializing = computed(() => state.value.matches({ idle: \"initializing\" }) ?? false)\n  const isConnecting = computed(() => state.value.matches({ idle: \"connecting\" }) ?? false)\n  const isDisconnecting = computed(() => state.value.matches({ idle: \"disconnecting\" }) ?? false)\n  const isIdle = computed(() => state.value.matches({ idle: \"idle\" }) ?? false)\n\n  let unsub\n  let unsub2\n  onMounted(() => {\n    unsub = client.on(\"connect\", onConnect)\n    unsub2 = client.on(\"disconnect\", onDisconnect)\n  })\n  onUnmounted(() => {\n    unsub()\n    unsub2()\n  })\n\n  return {\n    principal,\n    status,\n    activeProvider,\n    isConnected,\n    isConnecting,\n    isDisconnecting,\n    isInitializing,\n    isIdle,\n    connect: (provider) => {\n      client._service.send({ type: \"CONNECT\", data: { provider } })\n    },\n    disconnect: () => {\n      client._service.send({ type: \"DISCONNECT\" })\n    },\n  }\n}\n\nexport { useConnect }","import { useConnect } from \"./useConnect\"\nimport type { IConnector, IWalletConnector } from \"@connect2ic/core\"\nimport { computed, ref } from \"vue\"\nimport type { Ref } from \"vue\"\n\nexport const useWallet = () => {\n  const { isConnected, activeProvider } = useConnect()\n  const supportsWallet = computed(() => !!activeProvider.value?.meta.features.includes(\"wallet\"))\n  const wallet: Ref<IConnector & Partial<IWalletConnector> | undefined> = computed(() => {\n    return isConnected.value && supportsWallet.value && activeProvider.value ? (activeProvider.value as IConnector & Partial<IWalletConnector>) : undefined\n  })\n  const loading = ref(true)\n  const error = ref(false)\n\n  return [wallet, { loading, error }] as const\n}\n","<script setup lang=\"ts\">\nimport { useConnect, useDialog } from \"../composables\"\n\nconst emit = defineEmits([\"onConnect\", \"onDisconnect\"])\nconst props = defineProps({\n  dark: {\n    type: Boolean,\n    default: false,\n  },\n  style: {\n    type: String,\n    default: \"\",\n  },\n})\n\nconst { open } = useDialog()\n\nconst onConnect = () => {\n  emit(\"onConnect\", {})\n}\n\nconst onDisconnect = () => {\n  emit(\"onDisconnect\", {})\n}\n\nlet { isConnected, disconnect } = useConnect({\n  // providers,\n  onConnect,\n  onDisconnect,\n})\n\n</script>\n\n<template>\n  <button v-if=\"isConnected\" class=\"connect-button\" @click=\"() => disconnect()\">\n    Disconnect\n  </button>\n\n  <button v-if=\"!isConnected\" class=\"connect-button\" @click=\"() => open()\">\n    Connect\n  </button>\n</template>\n\n","<script setup lang=\"ts\">\nimport { onMounted, onUnmounted, watch } from \"vue\"\nimport { useConnect, useDialog, useProviders } from \"../composables\"\n\nconst { isOpen, close, open } = useDialog()\nconst providers = useProviders()\n\nconst { connect } = useConnect({\n  onConnect: () => {\n    close()\n  },\n})\n\nwatch(isOpen, ($isOpen) => {\n  if ($isOpen) {\n    document.body.style.overflow = \"hidden\"\n  }\n  if (!$isOpen) {\n    document.body.style.overflow = \"unset\"\n  }\n})\n\nconst emit = defineEmits([\"onClose\", \"onClickInside\"])\nconst onClose = () => {\n  close()\n  emit(\"onClose\")\n}\n\nconst onClickInside = (e) => {\n  e.stopPropagation()\n  emit(\"onClickInside\")\n}\n\nconst { dark = false } = defineProps<{\n  dark?: boolean\n}>()\n\nconst handleEsc = (event) => {\n  if (event.keyCode === 27) {\n    close()\n  }\n}\nonMounted(() => window.addEventListener(\"keydown\", handleEsc))\nonUnmounted(() => window.removeEventListener(\"keydown\", handleEsc))\n\n</script>\n\n<template>\n  <div v-if=\"isOpen\" :class=\"`dialog-styles ${dark ? ' dark' : ' light'}`\" @click=\"onClose\">\n    <div @click=\"onClickInside\" class=\"dialog-container\">\n      <div>\n        <button v-for=\"provider in providers\" :key=\"provider.meta.id\" @click=\"() => connect(provider.meta.id)\"\n                :class=\"`button-styles ${provider.meta.id}-styles`\">\n          <img class=\"img-styles\" :src=\"dark ? provider.meta.icon.dark : provider.meta.icon.light\" />\n          <div>\n            <span class=\"button-label\">{{ provider.meta.name }}</span>\n          </div>\n        </button>\n      </div>\n    </div>\n  </div>\n</template>","<script setup lang=\"ts\">\nimport { ref, provide } from \"vue\"\nimport { contextKey } from \"./context\"\nimport type { createClient } from \"@connect2ic/core\"\n\nlet open = ref(false)\nconst dialog = {\n  open: () => {\n    open.value = true\n  },\n  close: () => {\n    open.value = false\n  },\n  isOpen: open,\n}\n\nconst { client } = defineProps<{\n  client: ReturnType<typeof createClient>\n}>()\n\nprovide(contextKey, {\n  dialog,\n  client,\n})\n\n</script>\n<template>\n  <slot></slot>\n</template>\n","import { useWallet } from \"./useWallet\"\nimport { ref, watch } from \"vue\"\n\ntype Asset = {\n  amount: number\n  canisterId: string\n  decimals: number\n  image?: string\n  name: string\n  symbol: string\n}\n\nexport const useBalance = () => {\n  // TODO: check if supported or not\n  const [wallet] = useWallet()\n  // TODO:\n  const error = ref()\n  const loading = ref(true)\n  const assets = ref()\n\n  // TODO: fix\n  const refetch = async () => {\n    const $wallet = wallet.value\n    if (!$wallet) {\n      assets.value = undefined\n      return\n    }\n    const result = await $wallet.queryBalance?.()\n    assets.value = result\n    loading.value = false\n    return result\n  }\n\n  watch(wallet, ($wallet) => {\n    refetch()\n  })\n\n  return [assets, { loading, error, refetch }] as const\n}\n","import { useConnect } from \"./useConnect\"\nimport { useSelector } from \"@xstate/vue\"\nimport { inject, ref, computed } from \"vue\"\nimport type { Ref } from \"vue\"\nimport { contextKey } from \"../context\"\nimport type { ActorSubclass } from \"@dfinity/agent\"\n\nexport const useCanister = (\n  canisterName: string,\n  options: { mode: string } = {\n    mode: \"auto\", // \"anonymous\" | \"connected\"\n  },\n) => {\n  const { mode } = options\n  const { client } = inject(contextKey)\n  const anonymousActor = useSelector(client._service, (state) => state.context.anonymousActors[canisterName])\n  const actor = useSelector(client._service, (state) => state.context.actors[canisterName])\n  const { isConnected } = useConnect()\n  // @ts-ignore\n  const canister: Ref<ActorSubclass> = computed(() => {\n    return isConnected.value && actor.value && mode !== \"anonymous\" ? actor.value : anonymousActor.value\n  })\n  // TODO:\n  const loading = computed(() => !canister.value)\n  const error = ref(false)\n\n  return [canister, { error, loading }] as const\n}\n","import { useConnect } from \"./useConnect\"\nimport { useWallet } from \"./useWallet\"\nimport { ref } from \"vue\"\n\ntype Props = {\n  amount: number,\n  to: string,\n  from?: string,\n}\n\nexport const useTransfer = ({ amount, to, from = undefined }: Props) => {\n  // TODO: check if supported or not\n  const [wallet] = useWallet()\n  const { principal } = useConnect()\n  const loading = ref(true)\n  const error = ref()\n\n  const transfer = async () => {\n    const $wallet = wallet.value\n    if (!$wallet) {\n      return\n    }\n    loading.value = true\n    const result = await $wallet.requestTransfer?.({\n      amount,\n      to,\n    }).catch(e => {\n      error.value = e\n    })\n    loading.value = false\n    return result\n  }\n\n  return [transfer, { loading, error }] as const\n}\n"],"names":["contextKey","Symbol","useDialog","inject","dialog","useProviders","client","useSelector","_service","state","context","providers","useConnect","props","onConnect","onDisconnect","principal","activeProvider","status","value","idle","useActor","isConnected","computed","matches","isInitializing","isConnecting","isDisconnecting","isIdle","unsub","unsub2","onMounted","on","onUnmounted","connect","provider","send","type","data","disconnect","useWallet","supportsWallet","meta","features","includes","undefined","loading","ref","error","open","emit","isOpen","close","watch","$isOpen","document","body","style","overflow","onClose","onClickInside","e","stopPropagation","handleEsc","event","keyCode","window","addEventListener","removeEventListener","provide","wallet","assets","refetch","async","$wallet","result","queryBalance","canisterName","options","mode","anonymousActor","anonymousActors","actor","actors","canister","amount","to","from","requestTransfer","catch"],"mappings":"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"}